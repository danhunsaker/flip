#!/usr/local/bin/luvit
-- -*- mode: lua; tab-width: 2; indent-tabs-mode: 1; st-rulers: [70] -*-
-- vim: ts=4 sw=4 ft=lua noet
---------------------------------------------------------------------
-- @author Daniel Barney <daniel@pagodabox.com>
-- @copyright 2014, Pagoda Box, Inc.
-- @doc
--
-- @end
-- Created :   4 Sept 2014 by Daniel Barney <daniel@pagodabox.com>
---------------------------------------------------------------------

local fs = require('fs')
local JSON = require('json')
local utils = require('utils')
local Flip = require('./flip')
local logger = require('./lib/logger')
local jch = require('./lib/jch')


logger:add_logger('info','console',p)

-- set up default location for the config file
local configPath = "/opt/local/etc/flip/flip.conf"

-- it can be specified with the first parameter to the command
if process.argv[1] then
	configPath = process.argv[1]
end


-- load config file
fs.readFile(configPath,function(err,data)
	if err then
		logger:fatal('unable to load config file',err)
		process.exit(1)
	else
		local config = JSON.parse(data)
		local flip = Flip:new(config)

		logger:info('starting up flip',config)

		flip:start()
	end
end)